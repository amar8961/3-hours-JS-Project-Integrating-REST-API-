<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>3 hours JS Project (Integrating REST API)</title>
  </head>
  <body>
    <h4>3 hours JS Project (Integrating REST API)</h4>
    <form action="" onsubmit="saveToLocalStorage(event)">
      <label>Choose Expenses Amount</label>
      <input type="text" id="expenses" placeholder="Expenses Amount" />
      <label>Choose Description</label>
      <input type="text" id="description" placeholder="Enter Description" />
      <label>Choose Category</label>
      <select id="category">
        <option value="Fuel">Fuel</option>
        <option value="Food">Food</option>
        <option value="Electricity">Electricity</option>
        <option value="Movie">Movie</option>
      </select>
      <input type="submit" value="Add Expenses" />
    </form>
    <ul id="expenseTracker"></ul>

    <!-- add axios libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.1.3/axios.min.js"></script>

    <script>
      // Function for Show User Data On Screen
      function showNewUserOnScreen(user) {
        const parentNode = document.getElementById("expenseTracker");
        const childHTML = `<li id=${user._id}> ${user.expenses} - ${user.description} - ${user.category}</li>`;

        parentNode.innerHTML = parentNode.innerHTML + childHTML;
      }

      // Function for Save User Data On Screen
      function saveToLocalStorage(event) {
        event.preventDefault();
        const expenses = event.target.expenses.value;
        const description = event.target.description.value;
        const category = event.target.category.value;

        // Lets store the users in the right format ->
        const obj = {
          expenses,
          description,
          category,
        };

        // add axios libraries'post' - Saving the user Details on Crud Crud
        axios
          .post(
            "https://crudcrud.com/api/33a34c77d37b40de94d7e07770318fad/taskData",
            obj
          )
          .then((response) => {
            showNewUserOnScreen(response.data);
            console.log(response);
          })
          .catch((err) => {
            document.body.innerHTML =
              document.body.innerHTML + "<h4> Something went wrong </h4>";
            console.log(err);
          });
      }

      // add axios libraries'get' - Get the saved User Details from crudcrud.com
      window.addEventListener("DOMContentLoaded", () => {
        axios
          .get(
            "https://crudcrud.com/api/33a34c77d37b40de94d7e07770318fad/taskData"
          )
          .then((response) => {
            console.log(response);

            for (var i = 0; i < response.data.length; i++) {
              showNewUserOnScreen(response.data[i]);
            }
          })
          .catch((err) => {
            document.body.innerHTML =
              document.body.innerHTML +
              "<h4> Something went wrong in .get</h4>";
            console.log(err);
          });
      });
    </script>
  </body>
</html>
